function GetCategories(n){GetDataTable({fields:[{id:"\u041a\u043e\u0434",category_desc:"\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435",created:"\u0421\u043e\u0437\u0434\u0430\u043d\u0430",updated:"\u041e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0430",createdBy:"\u0410\u0432\u0442\u043e\u0440"}],actions:[{Details:"'Category'",Delete:"'Category'",Update:"'Category'"}]},"/api/categories/?substr="+n,15,"tree")}function CategoryEdit(n){$.get("/category/edit/"+n,function(n){$("#mt").text("\u0420\u0415\u0414\u0410\u041a\u0422\u0418\u0420\u041e\u0412\u0410\u041d\u0418\u0415 \u0417\u0410\u041f\u0418\u0421\u0418");$("#mb").empty().html(n);$("#categoryMessages").modal({keyboard:!1,backdrop:!1},"show")})}function CategoryDelete(n){$.get("/category/delete/"+n,function(n){$("#mt").text("\u0423\u0414\u0410\u041b\u0415\u041d\u0418\u0415 \u0417\u0410\u041f\u0418\u0421\u0418");$("#mb").empty().html(n);$("#categoryMessages").modal({keyboard:!1,backdrop:!1},"show")})}function CategoryToSubdirectory(n){__catId=n;console.log(__catId);$.get("/subcategory/index/?categoryid="+n,function(n){$("#ajaxpage").hide();$("#subCategory").empty().html(n).show()})}function GetSubCategories(n,t){GetDataTable({fields:[{id:"\u041a\u043e\u0434",subcategory_desc:"\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435",category_desc:"\u041a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u044f",created:"\u0421\u043e\u0437\u0434\u0430\u043d\u0430",updated:"\u041e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0430",createdBy:"\u0410\u0432\u0442\u043e\u0440"}],actions:[{Details:"'subCategory'",Delete:"'subCategory'",Update:"'subCategory'"}]},"/api/subcategories/?catid="+n+"&substr="+t,15,"subtree")}function SubCategoryEdit(n){$.get("/subcategory/edit/"+n,function(n){$("#mt").text("\u0420\u0415\u0414\u0410\u041a\u0422\u0418\u0420\u041e\u0412\u0410\u041d\u0418\u0415 \u0417\u0410\u041f\u0418\u0421\u0418");$("#mb").empty().html(n);$("#categoryMessages").modal({keyboard:!1,backdrop:!1},"show")})}function SubCategoryDelete(n){$.get("/subcategory/delete/"+n,function(n){$("#mt").text("\u0423\u0414\u0410\u041b\u0415\u041d\u0418\u0415 \u0417\u0410\u041f\u0418\u0421\u0418");$("#mb").empty().html(n);$("#categoryMessages").modal({keyboard:!1,backdrop:!1},"show")})}function SubdirectoryToCategory(){$("#subCategory").hide();$("#ajaxpage").show()}function Getproducts(n,t){GetDataTable({fields:[{id:"\u041a\u043e\u0434",product_name:"\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435",category_desc:"\u041a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u044f",subcategory_desc:"\u041f\u043e\u0434\u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u044f",created:"\u0421\u043e\u0437\u0434\u0430\u043d\u0430",updated:"\u041e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0430",createdBy:"\u0410\u0432\u0442\u043e\u0440"}],actions:[{Details:"'Product'",Delete:"'Product'",Update:"'Product'"}]},"/api/products/?id="+n+"&substr="+t,15,"producttree")}function ProductEdit(n){$.get("/Product/edit/"+n,function(n){$("#mt").text("\u0420\u0415\u0414\u0410\u041a\u0422\u0418\u0420\u041e\u0412\u0410\u041d\u0418\u0415 \u0417\u0410\u041f\u0418\u0421\u0418");$("#mb").empty().html(n);$("#categoryMessages").modal({keyboard:!1,backdrop:!1},"show")})}function ProductDelete(n){$.get("/Product/delete/"+n,function(n){$("#mt").text("\u0423\u0414\u0410\u041b\u0415\u041d\u0418\u0415 \u0417\u0410\u041f\u0418\u0421\u0418");$("#mb").empty().html(n);$("#categoryMessages").modal({keyboard:!1,backdrop:!1},"show")})}function SubdirectoryToProduct(n){__subCatId=n;$.get("/Product/index/"+n,function(n){$("#subCategory").hide();$("#product").empty().html(n).show()})}function ProductToSubCategory(){$("#product").hide();$("#subCategory").show()}function GetPersons(n,t){GetDataTable({fields:[{id:"\u041a\u043e\u0434",product_name:"\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435",category_desc:"\u041a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u044f",subcategory_desc:"\u041f\u043e\u0434\u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u044f",created:"\u0421\u043e\u0437\u0434\u0430\u043d\u0430",updated:"\u041e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0430",createdBy:"\u0410\u0432\u0442\u043e\u0440"}],actions:[{Details:"'Product'",Delete:"'Product'",Update:"'Product'"}]},"/api/products/?id="+n+"&substr="+t,15,"producttree")}function PersonEdit(n){$.get("/Product/edit/"+n,function(n){$("#mt").text("\u0420\u0415\u0414\u0410\u041a\u0422\u0418\u0420\u041e\u0412\u0410\u041d\u0418\u0415 \u0417\u0410\u041f\u0418\u0421\u0418");$("#mb").empty().html(n);$("#categoryMessages").modal({keyboard:!1,backdrop:!1},"show")})}function PersonCreate(){$.get("/person/create/",function(n){$("#mt").text("\u0421\u041e\u0417\u0414\u0410\u041d\u0418\u0415 \u041d\u041e\u0412\u041e\u0413\u041e \u041a\u041e\u041d\u0422\u0420\u0410\u0413\u0415\u041d\u0422\u0410");$("#mb").empty().html(n);$("#categoryMessages").modal({keyboard:!1,backdrop:!1},"show")})}function PersonDelete(n){$.get("/Product/delete/"+n,function(n){$("#mt").text("\u0423\u0414\u0410\u041b\u0415\u041d\u0418\u0415 \u0417\u0410\u041f\u0418\u0421\u0418");$("#mb").empty().html(n);$("#categoryMessages").modal({keyboard:!1,backdrop:!1},"show")})}function GetSex(n,t){$.get("/api/sex/",function(i){$(n).empty().append("<option><\/option>");$.each(i,function(t,i){$(n).append('<option value="'+i.id+'">'+i.description+"<\/option>")});t()})}function FillPersonCard(n,t){$.get("/api/persons/"+n,function(i){$("#persCard #id").val(i.id);$("#persCard #fam").val(i.fam).attr("disabled","disabled");$("#persCard #im").val(i.im).attr("disabled","disabled");$("#persCard #ot").val(i.ot).attr("disabled","disabled");$("#persCard #sexed").val(i.sex).attr("disabled","disabled");$("#persCard #dr").val(i.dr.substring(0,10)).attr("disabled","disabled");$("#persCard #doc_ser").val(i.passport_serie).attr("disabled","disabled");$("#persCard #doc_num").val(i.passport_num).attr("disabled","disabled");$("#persCard #passport_vidacha").val(i.passport_vidacha).attr("disabled","disabled");$("#persCard #cellPhone").val(i.cellPhone).attr("disabled","disabled");$("#persCard #adres").val(i.personAddres).attr("disabled","disabled");$("#persCard #comment").val(i.person_comment).attr("disabled","disabled");$("#persCard #cont_info").empty().append("<strong>\u0423\u043d\u0438\u043a\u0430\u043b\u044c\u043d\u044b\u0439 \u043a\u043e\u0434 \u043a\u043e\u043d\u0442\u0440\u0430\u0433\u0435\u043d\u0442\u0430:<\/strong> "+n).append(".    <strong>\u0417\u0430\u043f\u0438\u0441\u044c \u0441\u043e\u0437\u0434\u0430\u043d\u0430:<\/strong> "+i.created).append(".    <strong>\u041f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0435 \u0440\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435:<\/strong> "+i.updated);$("#butForPhotoUpdate").hide();$("#butForScanUpdate").hide();GetPersonPhoto(i.id);GetPersonPassScan(i.id);$("#editCard").click(function(n){$("#persCard #fam").removeAttr("disabled").focus();$("#persCard #im").removeAttr("disabled");$("#persCard #ot").removeAttr("disabled");$("#persCard #sexed").removeAttr("disabled");$("#persCard #dr").removeAttr("disabled");$("#persCard #doc_ser").removeAttr("disabled");$("#persCard #doc_num").removeAttr("disabled");$("#persCard #cellPhone").removeAttr("disabled");$("#persCard #adres").removeAttr("disabled");$("#persCard #comment").removeAttr("disabled");$("#persCard #passport_vidacha").removeAttr("disabled");$("#actionsButton").hide();$("#butForPhotoUpdate").show();$("#butForScanUpdate").show();$("#_saveCardButton").show();n.preventDefault()});t()})}function GetPersonPhoto(n){$.get("/api/personphotos/"+n,function(n){$("#srcfped").fadeIn("fast").attr("src",n)})}function GetPersonPassScan(n){$.get("/api/personscans/"+n,function(t){$("#pass_scan").fadeIn("fast").text(t).attr("data-id",n).attr("onclick","GetGullScan(this)")})}function GetGullScan(n){var t=$(n).data("id");window.open("/api/PersonFullScans/"+t,"blank")}function GetUsers(n){GetDataTable({fields:[{id:"\u041a\u043e\u0434",FIO:"\u0424\u0418\u041e \u0441\u043e\u0442\u0440\u0443\u0434\u043d\u0438\u043a\u0430",Name:"\u0420\u043e\u043b\u044c",orgName:"\u041e\u0442\u0434\u0435\u043b\u0435\u043d\u0438\u0435"}],actions:[{Details:"'User'",Delete:"'User'",Update:"'User'"}]},"/api/user/?substr="+n,15,"usertree")}function GetOrgs(n){GetDataTable({fields:[{orgName:"\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435",orgAdress:"\u0410\u0434\u0440\u0435\u0441",orgINN:"\u0418\u041d\u041d",orgOGRN:"\u041e\u0413\u0420\u041d",orgRuk:"\u0420\u0443\u043a\u043e\u0432\u043e\u0434\u0438\u0442\u0435\u043b\u044c"}],actions:[{Details:"'Org'",Delete:"'Org'",Update:"'Org'"}]},"/api/orgs/?substr="+n,15,"orgtree")}function GetOrgsForRegister(n){$.get("/api/orgs/?substr=",function(t){$(n).empty().append("<option><\/option>");$.each(t,function(t,i){$(n).append('<option value="'+i.id+'">'+i.orgName+"<\/option>")})})}function GetContracts(n,t){GetDataTable({fields:[{id:"\u041a\u043e\u0434",orgName:"\u041e\u0442\u0434\u0435\u043b\u0435\u043d\u0438\u0435",FIO:"\u041a\u043e\u043d\u0442\u0440\u0430\u0433\u0435\u043d\u0442",order_num:"\u041d\u043e\u043c\u0435\u0440",order_date:"\u0414\u0430\u0442\u0430",order_summ:"\u0421\u0443\u043c\u043c\u0430",estimated_close:"\u0421\u0440\u043e\u043a"}],actions:[{Details:"'ContractsDetails'"}],styles:[{cond:"estimated_close_data == 0 "}]},"/api/contracts/?substr="+n+"&stage="+t,15,"contracttree")}function GetOrgsForRegister(n){$.get("/api/orgs/?substr=",function(t){$(n).empty().append("<option><\/option>");$.each(t,function(t,i){$(n).append('<option value="'+i.id+'">'+i.orgName+"<\/option>")})})}function GetUserRolesForRegister(n){$.get("/api/userRoles/",function(t){$(n).empty().append("<option><\/option>");$.each(t,function(t,i){$(n).append('<option value="'+i.Name+'">'+i.Name+"<\/option>")})})}function CheckNewContractForm(){var n=!0,t=$("#newOrder input,select").filter("[required]");return $.each(t,function(t,i){$(i).val()==""?($(i).closest("div").addClass("has-error"),n=!1,$(i).off().change(function(){$(i).closest("div").hasClass("has-error")&&$(i).closest("div").removeClass("has-error")})):$(i).parent().parent().removeClass("danger")}),console.log($("#personContract").data("id")),$("#personContract").data("id")==undefined&&($("#personContract").closest("div").addClass("has-error"),n=!1),$("#productContract").data("id")===undefined&&($("#productContract").closest("div").addClass("has-error"),n=!1),n||$("#backtofirststep").click(),t=$("#secondStage input,select").filter("[required]"),$.each(t,function(t,i){$(i).val()==""?($(i).closest("div").addClass("has-error"),n=!1,$(i).off().change(function(){$(i).closest("div").hasClass("has-error")&&$(i).closest("div").removeClass("has-error")})):$(i).parent().parent().removeClass("danger")}),n}function PrepareContract(){if(CheckNewContractForm()){var n={personPK:$("#personContract").data("id"),productPK:$("#productContract").data("id"),order_sum:$("#summContract").val(),order_date:$("#order_date").val(),estimated_close:$("#estimatedDateContract").val(),product_serial:$("#product_serial").val(),contract_comment:$("#otmetki").val()};NewObject("/api/Contracts",n,6,function(){$("#secondStage").slideToggle(100);$("#thirdStage").slideToggle(100);$("#scnd").removeClass("btn-primary").addClass("btn-default");$("#thrd").removeClass("btn-default").addClass("btn-primary")})}}function GetPrintContract(n){window.open("/api/PrintOrders/?id="+n,"_blank")}var __catId="",__subCatId="",__catName="",__subCatName="";ContractDetails={GetContract:function(n,t){$.get("/Contract/details?id="+t,function(t){$(n).hide().html(t).show()})},GetContractDetails:function(n){$.get("/api/Contracts?id="+n,function(t){$("#cd-Seller").text(t.FIO);$("#cd-ContractNumber").text(t.order_num);$("#cd-Product").text(t.product_name);$("#cd-Summa").text(t.order_summ+" \u0440.");$("#cd-Serial").text(t.product_serial);$("#cd-ContactDate").text(t.order_date);$("#cd-Comment").text(t.order_comment);$("#cd-EstimateDate").text(t.estimated_close);$("#cd-info").html("\u0414\u043e\u0433\u043e\u0432\u043e\u0440 \u2116 <strong>"+t.order_num+"<\/strong>, \u043e\u0442 "+t.order_date);t.path!=null?$("#cd-OrderScan").html('<a style="cursor:pointer" onclick="ContractDetails.GetFullScan('+n+')">'+t.path+"<\/a>"):($("#cd-OrderScan").text("\u0421\u043a\u0430\u043d \u0434\u043e\u0433\u043e\u0432\u043e\u0440\u0430 \u043d\u0435 \u043e\u0431\u043d\u0430\u0440\u0443\u0436\u0435\u043d"),$("#cd-accept").hide());t.order_stage==3||t.order_stage==1002?($("#cd-accept").hide(),$("#cd-scanupload").hide()):($("#cd-reject").hide(),$("#cd-prolong").hide(),$("#cd-sell").hide())})},GetContractDetailsOnlyData:function(n){$.get("/api/Contracts?id="+n,function(n){return n})},ContactDetailsAction:function(n,t){switch(n){case 1:ContractDetails.UploadContractScan(t);break;case 5:ContractDetails.AcceptContract(t)}},UploadContractScan:function(n){$.get("/Contract/ScanUpload/"+n,function(n){$("#mt").text("\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0441\u043a\u0430\u043d\u0430 \u0434\u043e\u0433\u043e\u0432\u043e\u0440\u0430");$("#mb").empty().html(n);$("#categoryMessages").modal({keyboard:!1,backdrop:!1},"show")})},GetFullScan:function(n){window.open("/api/OrderScans?id="+n)},AcceptContract:function(n){$.get("/Contract/AcceptContract/"+n,function(n){$("#mt").text("\u041f\u0440\u043e\u0432\u0435\u0441\u0442\u0438 \u0434\u043e\u0433\u043e\u0432\u043e\u0440");$("#mb").empty().html(n);$("#categoryMessages").modal({keyboard:!1,backdrop:!1},"show")})},AcceptContractData:function(n){var t="";$.get("/api/kassa/getsumm/?d=",function(i){$.get("/api/Contracts?id="+n,function(r){console.log(r.order_summ>i);r!=null&&(r.order_summ>i?(t="\u0412 \u0434\u0430\u043d\u043d\u044b\u0439 \u043c\u043e\u043c\u0435\u043d\u0442 \u0432 \u043a\u0430\u0441\u0441\u0435 \u043d\u0430\u0445\u043e\u0434\u0438\u0442\u0441\u044f "+i+" \u0440\u0443\u0431.,                    \u0434\u043b\u044f \u043f\u0440\u043e\u0432\u0435\u0434\u0435\u043d\u0438\u044f \u043e\u043f\u0435\u0440\u0430\u0446\u0438\u0438 \u0442\u0440\u0435\u0431\u0443\u0435\u0442\u0441\u044f "+r.order_summ+" \u0440\u0443\u0431.                    \u0412\u043d\u0435\u0441\u0438\u0442\u0435 \u0432 \u043a\u0430\u0441\u0441\u0443 \u043d\u0435\u0434\u043e\u0441\u0442\u0430\u044e\u0449\u0443\u044e \u0441\u0443\u043c\u043c\u0443!",$("#ac-alert").removeClass("alert-info").addClass("alert-danger").html(t),$("#ac-accept").attr("disabled",!0)):(t="\u0412 \u0434\u0430\u043d\u043d\u044b\u0439 \u043c\u043e\u043c\u0435\u043d\u0442 \u0432 \u043a\u0430\u0441\u0441\u0435 \u043d\u0430\u0445\u043e\u0434\u0438\u0442\u0441\u044f "+i+" \u0440\u0443\u0431.,                    \u0438\u0437 \u043a\u0430\u0441\u0441\u044b \u0431\u0443\u0434\u0435\u0442 \u0432\u044b\u0434\u0430\u043d\u043e:  "+r.order_summ+" \u0440\u0443\u0431.",$("#ac-alert").html(t),$("#ac-accept").attr("disabled",!1).off().click(function(){var t={Id:n,Stage:3};UpdateObject("api/Contracts/SetStage",t,5,"")})))})})}};Kassa={Init:function(){var n=new Date;$("#ki-operdate").val(DateUtils.ToInputFormat(n.toLocaleDateString()));Kassa.GetOperDate("kassatree",DateUtils.ToInputFormat(n.toLocaleDateString()));$("#ki-setoperdate").off().click(function(){Kassa.GetOperDate("kassatree",$("#ki-operdate").val())})},GetOperDate:function(n,t){GetDataTable({fields:[{operation:"\u041e\u043f\u0435\u0440\u0430\u0446\u0438\u044f",summ:"\u0421\u0443\u043c\u043c\u0430",oper:"\u0410\u0432\u0442\u043e\u0440",operdate:"\u0412\u0440\u0435\u043c\u044f",comment:"\u041a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0439"}],actions:[{Details:"'KassaDetails'",Delete:"'KassaDetails'"}],styles:[{cond:"summ < 0 "}]},"/api/Kassa/GetOperDate?d="+t,15,n)},InitNewKassaOperation:function(n){$.get("api/Kassa/GetKassaOperationsType",function(t){$.each(t,function(t,i){$(n).append($('<option value="'+i.id+'">'+i.operation+"<\/option>"))})});$("#updOperation").off().click(function(){if($("").val()==""||$("").val()=="")return!1;var n={OType:$("#i-op").val(),Summ:$("#i-summ").val(),Comment:$("#i-comment").val()};NewObject("api/Kassa/NewKassaOperation",n,7,"")})},DeleteKassa:function(n){DeleteObject("api/Kassa/KassaOperationDel/?id="+n,4,"")},SetSummForNodeElement:function(){var n=new Date;$.get("api/Kassa/GetSumm/?d="+n.toLocaleDateString(),function(n){$("#mainorgsumm").text(n)})}};DateUtils={ToInputFormat:function(n){var t=n.substring(6,10),i=n.substring(3,5),r=n.substring(0,2);return t+"-"+i+"-"+r}};Messaging={ShowError:function(n,t){$.notify({icon:"glyphicon glyphicon-info-sign",message:n},{type:t,z_index:9999,offset:50})}};